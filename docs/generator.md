Migration Generators
====================
The generator creates a template migration file.  It pre-populates necessary fields by prompting for input when `flok init` is run.  You only need to read this documentation if you are interested in writing a small module to customise the template to your flavour or if you are a module developer and want your module to add content to a migration generated by `flok init`.


Philosophy
----------
I really wanted to reduce the barrier of entry to starting to create migrations for flok.  I was inspired by yeoman generators, but was concerned that with different plugins there would be fragmentation of each plugin's generator so I aimed to come up with an api with which plugins could add sections to a master template.

Run `flok init --modules flok-mongodb` and you get mongodb sugar in your template.  Run `flok init --modules flok-mongodb,flok-mysql` and get both mongodb and mysql sugar  :)  

Examples
--------
```js
    // simple require
    generate.require('async');

    // set base url to our ticketing system
    generate.constant('TICKETURL', 'https://tickets.company.com/?q=');

    // prompt the user for a ticket reference
    generate.constant('TICKET');

    // then use that const for logging
    generate.up('mig.log.info(\'migration for %s%s\', TICKETURL, TICKET);');
```

Will request the following input:

```
    >TICKET> ABC-123
    >id> (2e5ec915-a4db-4414-a41b-4f1f0cf25b99) 
    >title> My problem fix
```

And yield the following output:

```js
    //--modules
    var async = require('async');

    //--constants
    const TICKETURL = 'https://tickets.company.com/?q=';
    const TICKET = 'ABC-123';

    //--exports
    module.exports.id = '2e5ec915-a4db-4414-a41b-4f1f0cf25b99';
    module.exports.title = 'My problem fix';
    module.exports.time = '1380222464017';

    //--migrate function
    module.exports.up = function up(mig, flok, done) {
      //code to migrate
      mig.log.info('migration for %s%s', TICKETURL, TICKET);
    };
```

There are a handful of these high level functions, 1 for each section, but they all call the `register` method which you can use directly if you have special requirements.


Low Level API
-------------
### `register`
Takes a section and a callback.  The callback is executed when flok-init is executed and is passed the `program` instance and a callback function.

#### Arguments
* section - one of: `requires`, `constants`, `variables`, `functions`, `exports`, `dependencies`, `up` or `down`.
* callback(program, done) - `program` is the program instance from the `flok` bin. `done` is a function to execute when flok-init is run and the template is being built.  The first argument to `done` should be an error if there was one, and the second a string to be inserted into the migration.

```js
    var questions = [
      { name: 'name', message: 'enter name', type: 'string'},
      { name: 'email', message: 'enter email', type: 'string'}
    };
    flok.generate.register('exports', function (program, done) {
      flok.generate.prompt(questions, function (res) {
        done(null, 'module.exports.author = \'' + res.name + ' <' + res.email + '>\';');
      });
    });
```

The example above produces a prompt for name and email and then creates a familiar `name <email>` string for author.  It could have more easily been produced using the high level API though...

```js
    flok.generate.export('author', ['name', 'email'], '{{name}} <{{email}}>');
```

### `prompt`
A shortcut to `inquirer.prompt` from the excellent [inquirer](https://github.com/SBoudrias/Inquirer.js/) library.  Only recommended for use by plugin authors, not from within migrations because otherwise if inquirer make API breaking changes long term then your migrations might have to change which would break their signatures.  If you need a prompt within a migration it's recommended you load your own local version of a library so you have full control over the version of it.


High Level API
---------------
Each section has a high level function with relevant sugar for the section you're generating for.  Some have a common syntax, and some are unique.

### `constant`, `variable`, `export`
Define a `const`, `var` or export something from the migration.  The syntax for all 3 are identical and support 3 modes of operation however the first argument is always the name of the const, var or export:

Provide the value upfront.

```js
    generate.variable('foobar', 'baz');
    // var foobar = 'baz';
```

Simple prompt for a single response.

```js
    generate.variable('foobar');
    // var foobar = 'whatever the user responded with at the prompt';
```

Or use a template with multiple prompts by leveraging the full features [prompt.get](https://github.com/flatiron/prompt) function.

```js
    generate.variable('author', ['name', 'email'], '{{name}} <{{email}}>');
    // var author = 'Bill Board <bill@signs.com>';
```

### `require`
Require a module, repeating the module name as the variable name.

```js
    generate.require('async');
    // var async = require('async');
```

### `dependency`
Add a dependency to another migration.  Simply by ID.  `flok-init` already prompts for dependencies so this is probably only useful in situations where dependencies could be automatically detected somehow.

```js
    generate.dependency('bc86e77e-d4f8-4017-b4fa-48c1ae6af684');
    // module.exports.dependencies = [
    //   'bc86e77e-d4f8-4017-b4fa-48c1ae6af684'
    // ];
```

### `function`
A function will be converted to a string and inserted into the migration ready for use by `up` and `down`.

```js
    generate.function(function trim(s) { return s.replace(/ +$/, '').replace(/^ +/, ''); });
```

### `up`, `down`
Inserts indented lines into the up or down functions.

```js
    flok.generate.up('var log = mig.log;');
    // module.exports.up = function up(mig, flok, done) {
    //   var log = mig.log;
    // };
```